"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const deepmerge_1 = __importDefault(require("deepmerge"));
const validationPromise = async ({ errors, hook, originalDoc, fullOriginalDoc, data, fullData, id, field, path, skipValidation, user, operation, payload, }) => {
    if (hook !== 'beforeChange' || skipValidation)
        return true;
    const hasCondition = field.admin && field.admin.condition;
    const shouldValidate = field.validate && !hasCondition;
    let valueToValidate = data === null || data === void 0 ? void 0 : data[field.name];
    if (valueToValidate === undefined)
        valueToValidate = originalDoc === null || originalDoc === void 0 ? void 0 : originalDoc[field.name];
    if (valueToValidate === undefined)
        valueToValidate = field.defaultValue;
    const result = shouldValidate ? await field.validate(valueToValidate, {
        ...field,
        data: (0, deepmerge_1.default)(fullOriginalDoc, fullData),
        siblingData: (0, deepmerge_1.default)(originalDoc, data),
        id,
        operation,
        user,
        payload,
    }) : true;
    if (typeof result === 'string') {
        errors.push({
            message: result,
            field: `${path}${field.name}`,
        });
    }
    return result;
};
exports.default = validationPromise;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsaWRhdGlvblByb21pc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZmllbGRzL3ZhbGlkYXRpb25Qcm9taXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsMERBQThCO0FBc0I5QixNQUFNLGlCQUFpQixHQUFHLEtBQUssRUFBRSxFQUMvQixNQUFNLEVBQ04sSUFBSSxFQUNKLFdBQVcsRUFDWCxlQUFlLEVBQ2YsSUFBSSxFQUNKLFFBQVEsRUFDUixFQUFFLEVBQ0YsS0FBSyxFQUNMLElBQUksRUFDSixjQUFjLEVBQ2QsSUFBSSxFQUNKLFNBQVMsRUFDVCxPQUFPLEdBQ0csRUFBNkIsRUFBRTtJQUN6QyxJQUFJLElBQUksS0FBSyxjQUFjLElBQUksY0FBYztRQUFFLE9BQU8sSUFBSSxDQUFDO0lBRTNELE1BQU0sWUFBWSxHQUFHLEtBQUssQ0FBQyxLQUFLLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUM7SUFDMUQsTUFBTSxjQUFjLEdBQUcsS0FBSyxDQUFDLFFBQVEsSUFBSSxDQUFDLFlBQVksQ0FBQztJQUV2RCxJQUFJLGVBQWUsR0FBRyxJQUFJLGFBQUosSUFBSSx1QkFBSixJQUFJLENBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3pDLElBQUksZUFBZSxLQUFLLFNBQVM7UUFBRSxlQUFlLEdBQUcsV0FBVyxhQUFYLFdBQVcsdUJBQVgsV0FBVyxDQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMvRSxJQUFJLGVBQWUsS0FBSyxTQUFTO1FBQUUsZUFBZSxHQUFHLEtBQUssQ0FBQyxZQUFZLENBQUM7SUFFeEUsTUFBTSxNQUFNLEdBQUcsY0FBYyxDQUFDLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxRQUFRLENBQUMsZUFBZSxFQUFFO1FBQ3BFLEdBQUcsS0FBSztRQUNSLElBQUksRUFBRSxJQUFBLG1CQUFLLEVBQUMsZUFBZSxFQUFFLFFBQVEsQ0FBQztRQUN0QyxXQUFXLEVBQUUsSUFBQSxtQkFBSyxFQUFDLFdBQVcsRUFBRSxJQUFJLENBQUM7UUFDckMsRUFBRTtRQUNGLFNBQVM7UUFDVCxJQUFJO1FBQ0osT0FBTztLQUNSLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBRVYsSUFBSSxPQUFPLE1BQU0sS0FBSyxRQUFRLEVBQUU7UUFDOUIsTUFBTSxDQUFDLElBQUksQ0FBQztZQUNWLE9BQU8sRUFBRSxNQUFNO1lBQ2YsS0FBSyxFQUFFLEdBQUcsSUFBSSxHQUFHLEtBQUssQ0FBQyxJQUFJLEVBQUU7U0FDOUIsQ0FBQyxDQUFDO0tBQ0o7SUFFRCxPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDLENBQUM7QUFFRixrQkFBZSxpQkFBaUIsQ0FBQyJ9